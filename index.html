<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kostenvergelijking Nederland vs Zweden</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 0; 
            padding: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }
        
        .language-switcher {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }
        
        .language-btn {
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
        }
        
        .language-btn:hover {
            background: rgba(255,255,255,0.3);
            border-color: rgba(255,255,255,0.5);
        }
        
        .language-btn.active {
            background: white;
            color: #4CAF50;
            border-color: white;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 1.1em;
        }
        
        .content {
            padding: 30px;
        }
        
        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .category-header {
            font-weight: bold;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            text-align: center;
            font-size: 1.1em;
        }
        
        .cost-item {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }
        
        .cost-label {
            display: flex;
            align-items: center;
            font-weight: 500;
        }
        
        .cost-label .icon {
            font-size: 1.5em;
            margin-right: 10px;
            width: 30px;
            text-align: center;
        }
        
        .input-field {
            position: relative;
        }
        
        .input-field input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }
        
        .input-field input:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }
        
        .currency {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
            pointer-events: none;
        }
        
        .input-field input.with-currency {
            padding-left: 35px;
        }
        
        .results-section {
            margin-top: 40px;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 15px;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .result-item {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #ddd;
        }
        
        .result-value {
            padding: 15px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1.1em;
            text-align: center;
            border: 2px solid transparent;
        }
        
        .pastel-green {
            background-color: #d4edda !important;
            border-color: #c3e6cb !important;
            color: #155724 !important;
        }
        
        .pastel-red {
            background-color: #f8d7da !important;
            border-color: #f5c6cb !important;
            color: #721c24 !important;
        }
        
        .neutral {
            background-color: #e2e3e5;
            border-color: #d6d8db;
            color: #383d41;
        }
        
        .summary {
            margin-top: 30px;
            padding: 25px;
            background: white;
            border-radius: 10px;
            border-left: 5px solid #4CAF50;
        }
        
        .summary h3 {
            margin-top: 0;
            color: #4CAF50;
        }
        
        .download-section {
            margin-top: 30px;
            padding: 25px;
            background: #e3f2fd;
            border-radius: 10px;
            border-left: 5px solid #2196F3;
            text-align: center;
        }
        
        .download-btn {
            background: #2196F3;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            margin-top: 10px;
        }
        
        .download-btn:hover {
            background: #1976D2;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            font-size: 18px;
            color: #666;
        }
        
        @media (max-width: 768px) {
            .comparison-grid,
            .results-grid {
                grid-template-columns: 1fr;
            }
            
            .cost-item,
            .result-item {
                grid-template-columns: 1fr;
                text-align: center;
            }
            
            .cost-label {
                justify-content: center;
                margin-bottom: 10px;
            }
            
            .language-switcher {
                position: static;
                justify-content: center;
                margin-bottom: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="language-switcher" id="language-switcher">
                <!-- Language buttons will be generated dynamically -->
            </div>
            <h1 id="main-title">üí∞ Kostenvergelijking</h1>
            <p id="subtitle">Nederland vs Zweden - Senior Java Developer</p>
        </div>
        
        <div class="content">
            <div class="loading" id="loading">Gegevens laden...</div>
            <div id="main-content" style="display: none;">
                <div class="comparison-grid" id="header-grid">
                    <!-- Headers will be generated dynamically -->
                </div>
                
                <div id="cost-fields">
                    <!-- Cost fields will be generated dynamically -->
                </div>
                
                <!-- Results Section -->
                <div class="results-section">
                    <h2 id="results-title">üìä Resultaten</h2>
                    
                    <div class="comparison-grid" id="results-header-grid">
                        <!-- Results headers will be generated dynamically -->
                    </div>
                    
                    <div id="result-fields">
                        <!-- Result fields will be generated dynamically -->
                    </div>
                </div>
                
                <div class="summary">
                    <h3 id="summary-title">üìà Samenvatting</h3>
                    <p id="summary-text">Vul de velden in om een vergelijking te zien.</p>
                </div>
                
                <div class="download-section">
                    <h3 id="download-title">üì¶ Download Applicatie</h3>
                    <p id="download-description">Download de volledige webapplicatie om zelf te hosten of aan te passen.</p>
                    <a href="/download_app" class="download-btn" id="download-btn">‚¨áÔ∏è Download ZIP</a>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let configData = null;
        let currentLanguage = 'nl';
        let countryKeys = [];
        
        // Load configuration data from API
        async function loadConfigData() {
            try {
                const response = await fetch('/data/comparison_data.json');
                if (!response.ok) {
                    throw new Error('Failed to load configuration data');
                }
                configData = await response.json();
                countryKeys = Object.keys(configData.countries);
                
                // Initialize the application
                initializeApp();
            } catch (error) {
                console.error('Error loading configuration:', error);
                document.getElementById('loading').textContent = 'Fout bij het laden van gegevens. Probeer de pagina te vernieuwen.';
            }
        }
        
        function initializeApp() {
            generateLanguageSwitcher();
            generateHeaders();
            generateCostFields();
            generateResultFields();
            switchLanguage(currentLanguage);
            calculateAll();
            
            // Hide loading and show content
            document.getElementById('loading').style.display = 'none';
            document.getElementById('main-content').style.display = 'block';
        }
        
        function generateLanguageSwitcher() {
            const switcher = document.getElementById('language-switcher');
            const languages = Object.keys(configData.translations);
            const languageFlags = { 'nl': 'üá≥üá± NL', 'en': 'üá¨üáß EN', 'sv': 'üá∏üá™ SV' };
            
            switcher.innerHTML = '';
            languages.forEach(lang => {
                const btn = document.createElement('button');
                btn.className = 'language-btn';
                btn.textContent = languageFlags[lang] || lang.toUpperCase();
                btn.onclick = () => switchLanguage(lang);
                if (lang === currentLanguage) btn.classList.add('active');
                switcher.appendChild(btn);
            });
        }
        
        function generateHeaders() {
            const headerGrid = document.getElementById('header-grid');
            const resultsHeaderGrid = document.getElementById('results-header-grid');
            
            // Main headers
            headerGrid.innerHTML = `
                <div class="category-header" id="header-category">Kostenpost</div>
                ${countryKeys.map(key => {
                    const country = configData.countries[key];
                    return `<div class="category-header">${country.flag} <span id="header-${key}">${country.name}</span> (${country.currency})</div>`;
                }).join('')}
            `;
            
            // Results headers
            resultsHeaderGrid.innerHTML = `
                <div class="category-header" id="results-header-calculation">Berekening</div>
                ${countryKeys.map(key => {
                    const country = configData.countries[key];
                    return `<div class="category-header">${country.flag} <span id="results-header-${key}">${country.name}</span></div>`;
                }).join('')}
            `;
        }
        
        function generateCostFields() {
            const container = document.getElementById('cost-fields');
            container.innerHTML = '';
            
            configData.cost_fields.forEach(field => {
                const item = document.createElement('div');
                item.className = 'cost-item';
                
                const inputFields = countryKeys.map(countryKey => {
                    const country = configData.countries[countryKey];
                    const defaultValue = country.default_values[field.id] || 0;
                    const inputClass = field.input_type === 'currency' ? 'with-currency' : '';
                    const currencySymbol = field.input_type === 'currency' ? country.currency : 
                                         field.input_type === 'percentage' ? '%' : '';
                    
                    return `
                        <div class="input-field">
                            ${currencySymbol ? `<span class="currency">${currencySymbol}</span>` : ''}
                            <input type="number" 
                                   id="${field.id}-${countryKey}" 
                                   value="${defaultValue}" 
                                   class="${inputClass}"
                                   ${field.id === 'num_children' ? 'min="0"' : ''}
                                   oninput="calculateAll()">
                        </div>
                    `;
                }).join('');
                
                item.innerHTML = `
                    <div class="cost-label">
                        <span class="icon">${field.icon}</span>
                        <span id="label-${field.id}">Field Label</span>
                    </div>
                    ${inputFields}
                `;
                
                container.appendChild(item);
            });
        }
        
        function generateResultFields() {
            const container = document.getElementById('result-fields');
            container.innerHTML = '';
            
            configData.result_fields.forEach(field => {
                const item = document.createElement('div');
                item.className = 'result-item';
                
                const resultFields = countryKeys.map(countryKey => {
                    const country = configData.countries[countryKey];
                    return `<div class="result-value" id="${field.id}-${countryKey}">${country.currency} 0</div>`;
                }).join('');
                
                item.innerHTML = `
                    <div class="cost-label">
                        <span class="icon">${field.icon}</span>
                        <span id="result-${field.id}">Result Label</span>
                    </div>
                    ${resultFields}
                `;
                
                container.appendChild(item);
            });
        }
        
        function switchLanguage(lang) {
            currentLanguage = lang;
            
            // Update active button
            document.querySelectorAll('.language-btn').forEach(btn => btn.classList.remove('active'));
            const activeBtn = document.querySelector(`.language-btn[onclick*="${lang}"]`);
            if (activeBtn) {
                activeBtn.classList.add('active');
            }
            
            // Update all translatable elements
            const translations = configData.translations[lang];
            for (const [key, value] of Object.entries(translations)) {
                const element = document.getElementById(key.replace(/_/g, '-'));
                if (element) {
                    element.textContent = value;
                }
            }
            
            // Update field labels
            configData.cost_fields.forEach(field => {
                const element = document.getElementById(`label-${field.id}`);
                if (element && translations[field.id]) {
                    element.textContent = translations[field.id];
                }
            });
            
            // Update result labels
            configData.result_fields.forEach(field => {
                const element = document.getElementById(`result-${field.id}`);
                if (element && translations[field.id]) {
                    element.textContent = translations[field.id];
                }
            });
            
            // Update country names in headers
            countryKeys.forEach(key => {
                const headerElement = document.getElementById(`header-${key}`);
                const resultsHeaderElement = document.getElementById(`results-header-${key}`);
                if (headerElement) headerElement.textContent = configData.countries[key].name;
                if (resultsHeaderElement) resultsHeaderElement.textContent = configData.countries[key].name;
            });
            
            // Update document language
            document.documentElement.lang = lang;
            
            // Recalculate to update summary in new language
            calculateAll();
        }
        
        function calculateAll() {
            if (!configData) return;
            
            const data = {};
            const calculations = {};
            
            // Collect all input values
            countryKeys.forEach(countryKey => {
                data[countryKey] = {};
                configData.cost_fields.forEach(field => {
                    const element = document.getElementById(`${field.id}-${countryKey}`);
                    data[countryKey][field.id] = parseFloat(element.value) || 0;
                });
            });
            
            // Perform calculations for each country
            countryKeys.forEach(countryKey => {
                const countryData = data[countryKey];
                const country = configData.countries[countryKey];
                calculations[countryKey] = {};
                
                // Calculate child-related totals
                const totalChildAllowance = countryData.child_allowance * countryData.num_children;
                const totalChildcare = countryData.childcare_cost * countryData.num_children;
                const totalIntSchool = (countryData.international_school * countryData.num_children) / 12; // yearly to monthly
                
                // Calculate net salaries (including child allowance)
                calculations[countryKey].net_salary = countryData.salary * (1 - countryData.tax_rate / 100) + totalChildAllowance;
                
                // Calculate net freelance income (160 hours + child allowance)
                const freelanceHours = configData.calculation_settings.freelance_hours_per_month;
                calculations[countryKey].net_freelance = (countryData.freelance_rate * freelanceHours) * (1 - countryData.tax_rate / 100) + totalChildAllowance;
                
                // Calculate total fixed costs
                calculations[countryKey].total_costs = countryData.utilities + countryData.health_insurance + 
                    countryData.car_insurance + countryData.mortgage_rent + totalChildcare + 
                    countryData.contents_insurance + countryData.liability_insurance + 
                    countryData.internet + countryData.groceries + totalIntSchool;
                
                // Calculate disposable income
                calculations[countryKey].disposable_salary = calculations[countryKey].net_salary - calculations[countryKey].total_costs;
                calculations[countryKey].disposable_freelance = calculations[countryKey].net_freelance - calculations[countryKey].total_costs;
            });
            
            // Update display
            configData.result_fields.forEach(field => {
                const values = countryKeys.map(key => calculations[key][field.id]);
                updateResultDisplay(field.id, values, field.calculation_type === 'total_monthly_costs');
            });
            
            // Update input field colors
            updateInputColors();
            
            // Update summary
            updateSummary(calculations);
        }
        
        function updateResultDisplay(fieldId, values, inverse = false) {
            const currency = configData.countries[countryKeys[0]].currency;
            
            countryKeys.forEach((key, index) => {
                const elem = document.getElementById(`${fieldId}-${key}`);
                elem.textContent = `${currency} ${values[index].toFixed(2)}`;
                
                // Reset classes
                elem.className = "result-value";
                
                // Apply colors if values are different
                const allEqual = values.every(v => Math.abs(v - values[0]) < 0.01);
                if (!allEqual) {
                    const bestValue = inverse ? Math.min(...values) : Math.max(...values);
                    if (Math.abs(values[index] - bestValue) < 0.01) {
                        elem.classList.add("pastel-green");
                    } else {
                        elem.classList.add("pastel-red");
                    }
                } else {
                    elem.classList.add("neutral");
                }
            });
        }
        
        function updateInputColors() {
            configData.cost_fields.forEach(field => {
                const values = countryKeys.map(key => {
                    const elem = document.getElementById(`${field.id}-${key}`);
                    return parseFloat(elem.value) || 0;
                });
                
                const allEqual = values.every(v => Math.abs(v - values[0]) < 0.01);
                if (allEqual) return;
                
                countryKeys.forEach((key, index) => {
                    const elem = document.getElementById(`${field.id}-${key}`);
                    elem.style.backgroundColor = '';
                    
                    if (field.type === 'income') {
                        // For income, higher is better (green)
                        const maxValue = Math.max(...values);
                        if (Math.abs(values[index] - maxValue) < 0.01) {
                            elem.style.backgroundColor = '#d4edda';
                        } else {
                            elem.style.backgroundColor = '#f8d7da';
                        }
                    } else if (field.type === 'cost') {
                        // For costs, lower is better (green)
                        const minValue = Math.min(...values);
                        if (Math.abs(values[index] - minValue) < 0.01) {
                            elem.style.backgroundColor = '#d4edda';
                        } else {
                            elem.style.backgroundColor = '#f8d7da';
                        }
                    }
                });
            });
        }
        
        function updateSummary(calculations) {
            const summaryElement = document.getElementById("summary-text");
            const translations = configData.translations[currentLanguage];
            
            const salaryValues = countryKeys.map(key => calculations[key].disposable_salary);
            const freelanceValues = countryKeys.map(key => calculations[key].disposable_freelance);
            
            let text = '';
            
            // Compare salary disposable income
            const maxSalary = Math.max(...salaryValues);
            const maxSalaryIndex = salaryValues.indexOf(maxSalary);
            const minSalary = Math.min(...salaryValues);
            
            if (Math.abs(maxSalary - minSalary) > 0.01) {
                const bestCountry = configData.countries[countryKeys[maxSalaryIndex]].name;
                const difference = (maxSalary - minSalary).toFixed(2);
                text += translations.summary_employee_better
                    .replace('{country}', bestCountry)
                    .replace('{amount}', difference);
            } else {
                text += translations.summary_employee_equal;
            }
            
            // Compare freelance disposable income
            const maxFreelance = Math.max(...freelanceValues);
            const maxFreelanceIndex = freelanceValues.indexOf(maxFreelance);
            const minFreelance = Math.min(...freelanceValues);
            
            if (Math.abs(maxFreelance - minFreelance) > 0.01) {
                const bestCountry = configData.countries[countryKeys[maxFreelanceIndex]].name;
                const difference = (maxFreelance - minFreelance).toFixed(2);
                text += translations.summary_freelance_better
                    .replace('{country}', bestCountry)
                    .replace('{amount}', difference);
            } else {
                text += translations.summary_freelance_equal;
            }
            
            summaryElement.textContent = text;
        }
        
        // Initialize the application when the page loads
        document.addEventListener('DOMContentLoaded', loadConfigData);
    </script>
</body>
</html>

